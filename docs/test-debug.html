<!DOCTYPE html>
<html>
<head>
  <title>Debug Test</title>
</head>
<body>
  <h1>Debug Console</h1>
  <div id="output"></div>
  <script>
    const output = document.getElementById('output');

    async function test() {
      try {
        output.innerHTML += '<p>Fetching index.json...</p>';
        const response = await fetch('api/v1/search/index.json');
        output.innerHTML += '<p>Status: ' + response.status + '</p>';

        const protocolsData = await response.json();
        output.innerHTML += '<p>Data type: ' + typeof protocolsData + '</p>';
        output.innerHTML += '<p>Keys count: ' + Object.keys(protocolsData).length + '</p>';

        const protocols = Object.values(protocolsData).map(p => ({
          ...p,
          chains: p.deployments ? Object.keys(p.deployments).length : 0
        }));

        output.innerHTML += '<p>Converted to array: ' + protocols.length + ' protocols</p>';

        const protocolsWithDeployments = protocols
          .filter(p => p.chains && p.chains > 0)
          .sort((a, b) => b.chains - a.chains)
          .slice(0, 5);

        output.innerHTML += '<p>Top 5 protocols:</p>';
        protocolsWithDeployments.forEach(p => {
          output.innerHTML += '<p>- ' + p.name + ' (' + p.chains + ' chains)</p>';
        });

        output.innerHTML += '<p style="color: green">âœ“ Success!</p>';
      } catch (err) {
        output.innerHTML += '<p style="color: red">Error: ' + err.message + '</p>';
        output.innerHTML += '<p>' + err.stack + '</p>';
      }
    }

    test();
  </script>
</body>
</html>
