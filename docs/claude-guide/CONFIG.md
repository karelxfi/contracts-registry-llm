# Contracts Registry LLM - Claude Configuration

## Project Overview
This is a comprehensive smart contract registry that indexes and organizes blockchain protocol contracts across multiple chains. The registry provides structured data about protocols, their deployments, contract addresses, and metadata.

## Core Principles

### 1. **Data Integrity is Critical**
- Never modify data without verifying against official sources
- Always cross-reference contract addresses with official documentation
- When in doubt, ask the user before making changes
- Preserve existing verified data unless explicitly instructed to change it

### 2. **Source of Truth**
- Official protocol documentation is the primary source of truth
- DefiLlama API is a reliable secondary source
- Always document sources in the `source` and `sourceUrl` fields
- When updating data, cite where the information came from

### 3. **Build Before Commit**
- **ALWAYS** run `npm run build` after making changes to source files
- Verify generated files are created/updated correctly
- Check that no build errors occur
- Generated files in `data/generated/` and `docs/api/` must be committed

## File Structure

### Source Files (Manual Editing)
```
data/sources/
├── protocols/          # Protocol definitions (one folder per protocol)
│   └── {protocol}/
│       └── {protocol}.json
└── chains/            # Chain definitions
    └── {chain}.json
```

### Generated Files (Auto-Generated - Don't Edit Manually)
```
data/generated/         # Generated by build script
docs/api/              # API endpoints generated by build script
```

## Common Tasks

### Adding/Updating Protocol Addresses

1. **Find the source of truth** (official docs, GitHub, etc.)
2. **Read the existing protocol file** using Read tool
3. **Update the addresses** in `data/sources/protocols/{protocol}/{protocol}.json`
4. **Add metadata**:
   - `source`: Where the data came from (e.g., "official-docs", "defillama")
   - `sourceUrl`: URL to the source
   - `updated`: Current date in YYYY-MM-DD format
   - `verified`: Boolean for each contract address
5. **Run build**: `npm run build`
6. **Verify changes**: Check generated files
7. **Commit**: Use descriptive commit message

### Adding New Chain Support

1. **Check if chain file exists** in `data/sources/chains/`
2. **If creating new chain**, use this structure:
   ```json
   {
     "id": "chain-slug",
     "name": "Chain Name",
     "platform": "evm",
     "status": "active",
     "chainId": 123,
     "nativeCurrency": {
       "name": "Token Name",
       "symbol": "SYMBOL",
       "decimals": 18
     },
     "gecko_id": "coingecko-id",
     "cmcId": "coinmarketcap-id",
     "defillamaId": "defillama-slug",
     "explorers": {
       "primary": {
         "name": "Explorer Name",
         "url": "https://explorer.example.com"
       }
     },
     "rpc": {
       "public": []
     }
   }
   ```
3. **Add deployment** to protocol file with the new chain
4. **Add chain tag** to protocol's tags array
5. **Run build**

### External Platform IDs

The registry maps to three external platforms:

- **CoinGecko**: `gecko_id` field
- **CoinMarketCap**: `cmcId` field
- **DefiLlama**: `defillamaId` field

**Important Naming Differences:**
- Our ID: `bsc` → DefiLlama: `binance`
- Our ID: `gnosis` → DefiLlama: `xdai`
- Our ID: `hyperevm` → DefiLlama: `hyperliquid-l1`

Always check DefiLlama API when adding new chains: https://api.llama.fi/chains

## Critical Rules

### ❌ NEVER DO THIS:
1. **Never edit generated files directly** - they will be overwritten
2. **Never commit without building** - generated files must be in sync
3. **Never change addresses without verification** - data integrity is critical
4. **Never remove existing deployments without confirmation** - could break integrations
5. **Never use placeholder data** - all data must be real and verified

### ✅ ALWAYS DO THIS:
1. **Always read files before editing** - understand current state
2. **Always run `npm run build` after source changes**
3. **Always verify addresses against official sources**
4. **Always add source metadata** (source, sourceUrl, updated)
5. **Always test changes locally** before committing
6. **Always use consistent naming** - follow existing patterns

## Git Workflow

### Commit Messages
- Use clear, descriptive messages
- Common patterns:
  - `"api update"` - for general updates with build
  - `"Add {protocol} to {chain}"` - for new protocol deployments
  - `"Fix {protocol} addresses on {chain}"` - for corrections
  - `"Update {protocol} contracts"` - for contract updates

### Before Pushing
1. Verify git status shows expected changes
2. Check that generated files are included
3. Ensure no unintended files are staged
4. Run `git status --short` to review

## Common Mistakes to Avoid

### 1. Wrong Chain Identifier
- **Problem**: Using DefiLlama's chain name instead of our internal ID
- **Solution**: Always check `data/sources/chains/` for correct chain IDs
- **Example**: Use `hyperevm` not `hyperliquid-l1` as the chain key

### 2. Missing Build Step
- **Problem**: Committing source changes without rebuilding
- **Solution**: Always run `npm run build` and commit generated files

### 3. Incorrect Address Format
- **Problem**: Addresses without `0x` prefix or wrong checksum
- **Solution**: Use official addresses exactly as provided

### 4. Missing Metadata
- **Problem**: Adding addresses without source/verification info
- **Solution**: Always include `source`, `sourceUrl`, `updated`, `verified` fields

### 5. Forgetting Tags
- **Problem**: Adding chain deployment but not adding chain to tags array
- **Solution**: When adding new chain to deployments, add to tags array too

## Data Validation

### Before Committing, Verify:
- [ ] All addresses are valid Ethereum addresses (0x + 40 hex chars)
- [ ] Chain IDs match official chain IDs
- [ ] Source URLs are accessible
- [ ] Generated files exist and updated
- [ ] No TypeScript/build errors
- [ ] Git diff shows only intended changes

## DefiLlama Integration

When working with DefiLlama data:

1. **Fetch protocols**: `curl https://api.llama.fi/protocols`
2. **Fetch chains**: `curl https://api.llama.fi/chains`
3. **Map slugs correctly**: Our internal IDs may differ from DefiLlama
4. **Use defillamaId field**: Store DefiLlama's slug for cross-reference

## Testing Changes

1. **Build locally**: `npm run build`
2. **Check generated API**: Look at `docs/api/v1/protocol/{protocol}.json`
3. **Verify chain data**: Check `data/generated/by-chain/{chain}.json`
4. **Test queries**: Ensure data is queryable as expected

## When Uncertain

If you're unsure about:
- Address correctness → Verify with official source
- Chain naming → Check existing chain files
- Protocol structure → Look at similar protocols
- Data accuracy → Ask the user before proceeding

**Remember: It's better to ask than to commit incorrect data.**

## Emergency Rollback

If something goes wrong:
```bash
git log --oneline -10        # Find last good commit
git reset --hard <commit>    # Rollback to that commit
npm run build                # Rebuild
git push --force             # Push rollback (use with caution)
```

## Contact & Resources

- **DefiLlama API**: https://defillama.com/docs/api
- **Project Repo**: https://github.com/karelxfi/contracts-registry-llm
- **Live API**: https://karelxfi.github.io/contracts-registry-llm/api/

---

**Last Updated**: 2026-02-03
**Version**: 1.0
